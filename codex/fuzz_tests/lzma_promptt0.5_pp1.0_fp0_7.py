import lzma
# Test LZMADecompressor.decompress()

# This test is to make sure that the decompressor doesn't
# get stuck in a loop if the stream is truncated.

# Test data is generated by first compressing a 1 MB file
# with the xz command line tool, and then truncating the
# compressed stream at the end of the first block.

# The test data is not included in the repo because
# it is too big.

with open('xz-truncated-1mb.xz', 'rb') as f:
    compressed_data = f.read()

# Test that decompressing the truncated stream returns
# the expected amount of data
d = lzma.LZMADecompressor()
decompressed_data = d.decompress(compressed_data)
print(len(decompressed_data))

# Test that decompressing the truncated stream doesn't
# hang
start = time.time()
d = lzma.LZMADecompressor()
d.decompress(compressed_data, max_length=1024 * 1024)
print("time:
